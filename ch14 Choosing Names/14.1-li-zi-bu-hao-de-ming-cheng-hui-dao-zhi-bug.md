# 14.1 例子：不好的名字会导致bug

有时，即使是一个命名不当的变量也会产生严重的后果。我曾经修复过的最具挑战性的错误就是因为一个糟糕的名称选择。在20世纪80年代末和90年代初，我和我的研究生们创建了一个叫做Sprite的分布式操作系统。在某些时候，我们注意到文件偶尔会丢失数据：其中一个数据块突然变成了所有的零，即使该文件没有被用户修改。这个问题并不经常发生，所以追踪起来特别困难。有几个研究生试图找到这个错误，但他们无法取得进展，最终放弃了。然而，我认为任何未解决的bug都是一种不可容忍的个人侮辱，所以我决定追踪它。

花了六个月的时间，但我最终发现并修复了这个bug。这个问题实际上很简单（就像大多数错误一样，一旦你发现了它们）。文件系统代码将变量名称block用于两个不同的目的。在某些情况下，block指的是磁盘上的一个物理块号；在其他情况下，block指的是文件中的一个逻辑块号。不幸的是，在代码中的某一点上，有一个包含逻辑块号的block变量，但它被意外地用在了需要物理块号的环境中；结果，磁盘上一个不相关的块被覆盖成了0。

在追踪这个错误的时候，有几个人，包括我自己，阅读了有问题的代码，但是我们从来没有注意到这个问题。当我们看到变量块被用作物理块号时，我们反射性地认为它确实是一个物理块号。我花了很长的时间来检测，最终发现腐败一定是发生在一个特定的语句中，然后我才能够克服由名字造成的心理障碍，检查出它的值到底来自哪里。如果不同类型的块使用了不同的变量名，比如fileBlock和diskBlock，就不可能发生错误；程序员会知道fileBlock不能在这种情况下使用。

不幸的是，大多数开发者并没有花很多时间考虑名字的问题。他们倾向于使用想到的第一个名字，只要它与它所命名的东西相当接近就可以了。例如，block是一个与磁盘上的物理块和文件中的逻辑块都非常接近的名字；它当然不是一个可怕的名字。即便如此，它还是导致了追踪一个微妙的错误而花费了大量的时间。因此，你不应该满足于那些只是 "相当接近 "的名字。花一点额外的时间来选择伟大的名字，这些名字要精确、明确和直观。额外的关注将很快得到回报，而且随着时间的推移，你将学会快速选择好的名字。 使用www.DeepL.com/Translator翻译（免费版）
