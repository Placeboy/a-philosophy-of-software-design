# 10.4 示例：在Windows中删除文件

文件的删除提供了另一个例子，说明错误可以被定义掉。如果文件在一个进程中打开，Windows操作系统不允许删除该文件。这对开发者和用户来说是一个持续的挫折来源。为了删除一个正在使用的文件，用户必须在系统中搜索，找到打开该文件的进程，然后杀掉该进程。有时，用户会放弃并重新启动他们的系统，只是为了能删除一个文件。

Unix操作系统对文件删除的定义更加优雅。在Unix中，如果一个文件被删除时是打开的，Unix不会立即删除该文件。相反，它标记该文件为删除，然后删除操作成功返回。文件名已经从其目录中删除，所以没有其他进程可以打开旧文件，可以创建一个同名的新文件，但现有的文件数据仍然存在。已经打开该文件的进程可以继续正常读取和写入该文件。一旦文件被所有的访问进程关闭，它的数据就被释放了。

Unix的方法定义了两种不同的错误。首先，如果文件目前正在使用中，删除操作不再返回错误；删除成功，文件最终会被删除。第二，删除一个正在使用中的文件，不会为使用该文件的进程产生异常。解决这个问题的一个可能的方法是立即删除文件，并标记该文件的所有打开方式，使其失效；其他进程读取或写入被删除文件的任何尝试都会失败。然而，这种方法会给这些进程带来新的错误。相反，Unix允许它们继续正常地访问该文件；延迟文件的删除定义了不存在的错误。

Unix允许一个进程继续读写一个注定失败的文件，这可能看起来很奇怪，但我从来没有遇到过这样的情况，这导致了重大问题。Unix对文件删除的定义比Windows的定义要简单得多，无论是对开发人员还是对用户。&#x20;
