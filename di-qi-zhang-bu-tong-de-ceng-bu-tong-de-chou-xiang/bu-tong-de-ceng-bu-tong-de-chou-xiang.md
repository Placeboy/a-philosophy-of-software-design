# 不同的层，不同的抽象

软件系统是分层组成的，高层使用低层提供的设施。在一个设计良好的系统中，每一层都提供了与上层和下层不同的抽象；如果你通过调用方法来跟踪一个单一的操作在各层中的上下移动，那么抽象会随着每个方法的调用而改变。比如说。

在一个文件系统中，最上面的一层实现了一个文件抽象。一个文件由一个可变长度的字节数组组成，它可以通过读写可变长度的字节范围来更新。文件系统的下一个底层实现了固定大小的磁盘块在内存中的缓存；调用者可以假设经常使用的块会留在内存中，可以快速访问它们。最底层由设备驱动程序组成，它们在二级存储设备和内存之间移动块。

在网络传输协议（如TCP）中，最上层提供的抽象是一个字节流从一台机器可靠地传递到另一台机器。这个层次建立在一个较低的层次上，这个层次在机器之间以尽力而为的方式传输大小有限的数据包：大多数数据包将被成功交付，但有些数据包可能会丢失或不按顺序交付。

如果一个系统包含具有类似抽象的相邻层，这就是一个红旗，表明类的分解有问题。本章讨论了发生这种情况的情况，导致的问题，以及如何重构以消除这些问题。
